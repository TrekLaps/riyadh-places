<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù‡Ø§Ø¨Ù‘ Ø§Ù„Ø­ÙŠÙ† ğŸ”¥ - Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© | ÙˆÙŠÙ† Ù†Ø±ÙˆØ­ Ø¨Ø§Ù„Ø±ÙŠØ§Ø¶ØŸ</title>
  <meta name="description" content="Ø®Ø±ÙŠØ·Ø© Ø­Ø±Ø§Ø±Ø© Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø±ÙŠØ§Ø¶ â€” Ø§ÙƒØªØ´Ù Ø£ÙƒØ«Ø± 20 Ù…ÙƒØ§Ù† Ø±Ø§Ø¦Ø¬ Ø§Ù„Ø­ÙŠÙ†! ØªÙ‚ÙŠÙŠÙ…Ø§ØªØŒ Ø§ÙØªØªØ§Ø­Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©ØŒ ÙˆØ§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù„ÙŠ Ø§Ù„ÙƒÙ„ ÙŠØªÙƒÙ„Ù… Ø¹Ù†Ù‡Ø§.">
  <meta name="keywords" content="Ø£Ù…Ø§ÙƒÙ† Ù…Ø²Ø¯Ø­Ù…Ø© Ø§Ù„Ø±ÙŠØ§Ø¶, Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø±Ø§Ø¦Ø¬Ø© Ø§Ù„Ø±ÙŠØ§Ø¶, heat map riyadh, popular places riyadh">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://wain-nrooh.com/trending.html">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Ù‡Ø§Ø¨Ù‘ Ø§Ù„Ø­ÙŠÙ† ğŸ”¥ - Ø®Ø±ÙŠØ·Ø© Ø­Ø±Ø§Ø±Ø© Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø±ÙŠØ§Ø¶">
  <meta property="og:description" content="Ø´ÙˆÙ Ø£ÙƒØ«Ø± 20 Ù…ÙƒØ§Ù† Ø±Ø§Ø¦Ø¬ Ø¨Ø§Ù„Ø±ÙŠØ§Ø¶ Ø¹Ù„Ù‰ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©!">
  <meta property="og:url" content="https://wain-nrooh.com/trending.html">
  <meta property="og:locale" content="ar_SA">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0a1628">
  <!-- Performance: preconnect & preload -->
  <link rel="preconnect" href="https://images.unsplash.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="dns-prefetch" href="https://images.unsplash.com">
  <link rel="preload" href="data/places-light.json" as="fetch" crossorigin>
  <!-- Critical inline CSS for above-the-fold -->
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Tajawal',sans-serif;background:#0a1628;color:#e0e0e0;direction:rtl}
    .header{background:linear-gradient(135deg,#0a1628 0%,#1a2a4a 100%);padding:12px 20px;position:sticky;top:0;z-index:100}
    .header-inner{display:flex;align-items:center;justify-content:space-between;max-width:1400px;margin:auto}
    .logo{text-decoration:none;color:#c9a84c;display:flex;align-items:center;gap:8px}
    .logo h1{font-size:1.2rem;margin:0}
    .cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px}
    .place-card{background:#111b2e;border-radius:16px;overflow:hidden;transition:transform .2s}
    .place-card-image{height:180px;background:#1a2a4a;position:relative;overflow:hidden}
    .card-image{width:100%;height:100%;object-fit:cover}
    .skeleton{animation:skeleton-pulse 1.5s ease-in-out infinite}
    @keyframes skeleton-pulse{0%,100%{opacity:.4}50%{opacity:.8}}
    .place-card{content-visibility:auto;contain-intrinsic-size:0 420px}
  </style>

  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/ramadan.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <link rel="stylesheet" href="css/search-header.css">
</head>
<body>

  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo"><span>ğŸ™ï¸</span><h1>ÙˆÙŠÙ† Ù†Ø±ÙˆØ­ Ø¨Ø§Ù„Ø±ÙŠØ§Ø¶ØŸ</h1></a>
      <button class="dark-mode-toggle" aria-label="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ">ğŸŒ™</button>
      <button class="menu-toggle" aria-label="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">â˜°</button>
      <nav class="nav">
        <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="cafes.html">ÙƒØ§ÙÙŠÙ‡Ø§Øª</a>
        <a href="restaurants.html">Ù…Ø·Ø§Ø¹Ù…</a>
        <a href="activities.html">ØªØ±ÙÙŠÙ‡</a>
        <a href="events.html">ÙØ¹Ø§Ù„ÙŠØ§Øª</a>
        <a href="new-places.html">Ø¬Ø¯ÙŠØ¯</a>
        <a href="discover.html">ğŸ² ÙˆÙŠÙ† Ù†Ø±ÙˆØ­ØŸ</a>
        <a href="lists.html">ğŸ“‹ Ù‚ÙˆØ§Ø¦Ù…ÙŠ</a>
        <div class="nav-dropdown">
          <a href="#">Ø§Ù„Ù…Ø²ÙŠØ¯</a>
          <div class="dropdown-menu">
            <a href="shopping.html">ğŸ›ï¸ ØªØ³ÙˆÙ‚</a>
            <a href="nature.html">ğŸï¸ Ø·Ø¨ÙŠØ¹Ø©</a>
            <a href="desserts.html">ğŸ° Ø­Ù„ÙˆÙŠØ§Øª</a>
            <a href="top-rated.html">â­ Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹</a>
            <div class="dropdown-divider"></div>
            <a href="neighborhoods.html">ğŸ˜ï¸ Ø£Ø­ÙŠØ§Ø¡ Ø§Ù„Ø±ÙŠØ§Ø¶</a>
            <a href="events.html">ğŸ‡¸ğŸ‡¦ ÙŠÙˆÙ… Ø§Ù„ØªØ£Ø³ÙŠØ³</a>
            <a href="riyadh-season.html">âœ¨ Ù…ÙˆØ³Ù… Ø§Ù„Ø±ÙŠØ§Ø¶</a>
            <div class="dropdown-divider"></div>
            <div class="dropdown-submenu">
              <a href="#">ğŸ˜ï¸ Ø§Ù„Ø£Ø­ÙŠØ§Ø¡</a>
              <div class="submenu">
                <a href="neighborhood-olaya.html">Ø­ÙŠ Ø§Ù„Ø¹Ù„ÙŠØ§</a>
                <a href="neighborhood-malqa.html">Ø­ÙŠ Ø§Ù„Ù…Ù„Ù‚Ø§</a>
                <a href="neighborhood-hittin.html">Ø­ÙŠ Ø­Ø·ÙŠÙ†</a>
                <a href="neighborhood-yasmin.html">Ø­ÙŠ Ø§Ù„ÙŠØ§Ø³Ù…ÙŠÙ†</a>
                <a href="neighborhood-rabee.html">Ø­ÙŠ Ø§Ù„Ø±Ø¨ÙŠØ¹</a>
                <a href="neighborhood-narjis.html">Ø­ÙŠ Ø§Ù„Ù†Ø±Ø¬Ø³</a>
                <a href="neighborhood-wurud.html">Ø­ÙŠ Ø§Ù„ÙˆØ±ÙˆØ¯</a>
                <a href="neighborhood-sahafa.html">Ø­ÙŠ Ø§Ù„ØµØ­Ø§ÙØ©</a>
                <a href="neighborhood-muruj.html">Ø­ÙŠ Ø§Ù„Ù…Ø±ÙˆØ¬</a>
                <a href="neighborhood-nakheel.html">Ø­ÙŠ Ø§Ù„Ù†Ø®ÙŠÙ„</a>
                <a href="neighborhood-diriyah.html">Ø§Ù„Ø¯Ø±Ø¹ÙŠØ©</a>
                <a href="neighborhood-kafd.html">KAFD</a>
                <a href="neighborhood-safarat.html">Ø­ÙŠ Ø§Ù„Ø³ÙØ§Ø±Ø§Øª</a>
                <a href="neighborhood-malz.html">Ø­ÙŠ Ø§Ù„Ù…Ù„Ø²</a>
                <a href="neighborhood-aqiq.html">Ø­ÙŠ Ø§Ù„Ø¹Ù‚ÙŠÙ‚</a>
                <a href="neighborhood-sulaymaniyah.html">Ø­ÙŠ Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©</a>
                <a href="neighborhood-gharnata.html">ØºØ±Ù†Ø§Ø·Ø©</a>
                <a href="neighborhood-rabwa.html">Ø­ÙŠ Ø§Ù„Ø±Ø¨ÙˆØ©</a>
                <a href="neighborhood-arid.html">Ø­ÙŠ Ø§Ù„Ø¹Ø§Ø±Ø¶</a>
                <a href="neighborhood-ghdir.html">Ø­ÙŠ Ø§Ù„ØºØ¯ÙŠØ±</a>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <section class="page-header">
    <h2>ğŸ”¥ Ù‡Ø§Ø¨Ù‘ <span>Ø§Ù„Ø­ÙŠÙ†</span></h2>
    <p>Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© â€” Ø£ÙƒØ«Ø± 20 Ù…ÙƒØ§Ù† Ø±Ø§Ø¦Ø¬ Ø¨Ø§Ù„Ø±ÙŠØ§Ø¶ Ù…Ø¹ Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø±ÙˆØ§Ø¬ ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</p>
  </section>

  <div class="breadcrumb">
    <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a> <span>â€º</span> Ù‡Ø§Ø¨Ù‘ Ø§Ù„Ø­ÙŠÙ† ğŸ”¥
  </div>

  <div class="heatmap-container">
    <!-- Last Update Banner -->
    <div class="heatmap-update-banner">
      <div class="live-dot"></div>
      <span id="live-time">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
      <span class="update-separator">|</span>
      <span id="last-update">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ...</span>
    </div>

    <!-- Heat Map Legend -->
    <div class="heatmap-legend">
      <span class="legend-title">Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø±ÙŠØ·Ø©:</span>
      <span class="legend-item"><span class="legend-dot" style="background:#e74c3c;"></span> ğŸ”´ Ø­Ø§Ø± Ø¬Ø¯Ø§Ù‹</span>
      <span class="legend-item"><span class="legend-dot" style="background:#f39c12;"></span> ğŸŸ¡ Ø±Ø§Ø¦Ø¬</span>
      <span class="legend-item"><span class="legend-dot" style="background:#2ecc71;"></span> ğŸŸ¢ Ø¹Ø§Ø¯ÙŠ</span>
    </div>

    <!-- Category Filter Tabs -->
    <div class="filter-tabs" id="heat-category-filters">
      <button class="filter-tab active" data-cat="all">ğŸ™ï¸ Ø§Ù„ÙƒÙ„</button>
      <button class="filter-tab" data-cat="restaurant">ğŸ½ï¸ Ù…Ø·Ø§Ø¹Ù…</button>
      <button class="filter-tab" data-cat="cafe">â˜• ÙƒØ§ÙÙŠÙ‡Ø§Øª</button>
      <button class="filter-tab" data-cat="entertainment">ğŸ® ØªØ±ÙÙŠÙ‡</button>
      <button class="filter-tab" data-cat="activity">ğŸ­ Ø£Ù†Ø´Ø·Ø©</button>
      <button class="filter-tab" data-cat="shopping">ğŸ›ï¸ ØªØ³ÙˆÙ‚</button>
      <button class="filter-tab" data-cat="desserts">ğŸ° Ø­Ù„ÙˆÙŠØ§Øª</button>
      <button class="filter-tab" data-cat="nature">ğŸï¸ Ø·Ø¨ÙŠØ¹Ø©</button>
    </div>

    <!-- Heat Map -->
    <div id="heatmap" class="heatmap-map"></div>

    <!-- Top 20 Section -->
    <div class="heatmap-top-section">
      <div class="heatmap-top-header">
        <h2>ğŸ† Ø£ÙƒØ«Ø± 20 Ù…ÙƒØ§Ù† Ø±ÙˆØ§Ø¬Ø§Ù‹</h2>
        <span id="top-count" class="heatmap-count"></span>
      </div>

      <div id="heatmap-cards" class="heatmap-cards-grid"></div>
    </div>
  </div>

  <footer class="footer">
    <div class="footer-inner">
      <div>
        <h3>ÙˆÙŠÙ† Ù†Ø±ÙˆØ­ Ø¨Ø§Ù„Ø±ÙŠØ§Ø¶ØŸ</h3>
        <p>Ø¯Ù„ÙŠÙ„Ùƒ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ Ù…Ø¹ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù‚ÙˆÙ‚Ù„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©. Ù…Ø­Ø¯Ø« ÙŠÙˆÙ…ÙŠØ§Ù‹ Ø¨Ø£Ø­Ø¯Ø« Ø§Ù„Ø£Ù…Ø§ÙƒÙ† ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª.</p>
      </div>
      <div>
        <h3>Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h3>
        <ul>
          <li><a href="cafes.html">ÙƒØ§ÙÙŠÙ‡Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶</a></li>
          <li><a href="restaurants.html">Ù…Ø·Ø§Ø¹Ù… Ø§Ù„Ø±ÙŠØ§Ø¶</a></li>
          <li><a href="activities.html">ØªØ±ÙÙŠÙ‡ ÙˆØ£Ù†Ø´Ø·Ø©</a></li>
          <li><a href="shopping.html">ØªØ³ÙˆÙ‚ Ø¨Ø§Ù„Ø±ÙŠØ§Ø¶</a></li>
          <li><a href="nature.html">Ø·Ø¨ÙŠØ¹Ø© ÙˆØ±Ø­Ù„Ø§Øª</a></li>
          <li><a href="desserts.html">Ø­Ù„ÙˆÙŠØ§Øª Ø§Ù„Ø±ÙŠØ§Ø¶</a></li>
          <li><a href="events.html">ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø±ÙŠØ§Ø¶</a></li>
          <li><a href="trending.html">Ù‡Ø§Ø¨Ù‘ Ø§Ù„Ø­ÙŠÙ† ğŸ”¥</a></li>
          <li><a href="top-rated.html">Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹</a></li>
          <li><a href="new-places.html">Ø£Ù…Ø§ÙƒÙ† Ø¬Ø¯ÙŠØ¯Ø©</a></li>
          <li><a href="lists.html">ğŸ“‹ Ù‚ÙˆØ§Ø¦Ù…ÙŠ</a></li>
          <li><a href="map.html">ğŸ—ºï¸ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a></li>
          <li><a href="favorites.html">â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø©</a></li>
        </ul>
      </div>
      <div>
        <h3>Ø±ÙˆØ§Ø¨Ø· Ù…ÙÙŠØ¯Ø©</h3>
        <ul>
          <li><a href="sitemap.xml">Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹</a></li>
          <li><a href="#">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a></li>
          <li><a href="#">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-heart">ØµÙ†Ø¹ Ø¨Ù€ <span>â¤ï¸</span> ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶</div>
    <div class="footer-bottom"><p>Â© 2025-2026 ÙˆÙŠÙ† Ù†Ø±ÙˆØ­ Ø¨Ø§Ù„Ø±ÙŠØ§Ø¶ØŸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p></div>
  </footer>

  <button class="scroll-top" id="scrollTop" aria-label="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰">â†‘</button>

  <style>
    .heatmap-container {
      max-width: var(--max-width, 1200px);
      margin: 20px auto;
      padding: 0 20px;
    }

    /* Update Banner */
    .heatmap-update-banner {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 14px 20px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: white;
      border-radius: var(--radius);
      margin-bottom: 16px;
      font-size: 14px;
      font-weight: 600;
      flex-wrap: wrap;
    }
    .live-dot {
      width: 10px;
      height: 10px;
      background: #2ecc71;
      border-radius: 50%;
      animation: pulse 1.5s infinite;
      flex-shrink: 0;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(46,204,113,0.4); }
      50% { opacity: 0.7; box-shadow: 0 0 0 8px rgba(46,204,113,0); }
    }
    .update-separator { opacity: 0.4; }
    #last-update { opacity: 0.8; font-size: 13px; }

    /* Legend */
    .heatmap-legend {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px 18px;
      background: var(--card-bg);
      border-radius: var(--radius-sm);
      margin-bottom: 16px;
      box-shadow: var(--shadow);
      flex-wrap: wrap;
      font-size: 13px;
    }
    .legend-title { font-weight: 700; color: var(--primary); }
    .legend-item { display: inline-flex; align-items: center; gap: 6px; color: var(--text-light); }
    .legend-dot { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; }

    /* Heat Map */
    .heatmap-map {
      width: 100%;
      height: 50vh;
      min-height: 350px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 24px;
      z-index: 1;
    }

    /* Leaflet popup */
    .leaflet-popup-content-wrapper {
      border-radius: 16px !important;
      font-family: 'Tajawal', sans-serif !important;
      direction: rtl;
      box-shadow: 0 8px 30px rgba(0,0,0,0.2) !important;
    }
    .leaflet-popup-content { margin: 12px 16px !important; }

    /* Top section */
    .heatmap-top-section { margin-top: 8px; }
    .heatmap-top-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 8px;
    }
    .heatmap-top-header h2 {
      font-size: 24px;
      font-weight: 800;
      color: var(--primary);
      margin: 0;
    }
    .heatmap-count {
      font-size: 14px;
      color: var(--text-muted);
      font-weight: 600;
    }

    /* Heatmap card grid */
    .heatmap-cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 20px;
    }

    /* Individual Heat Card */
    .heat-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      position: relative;
      border-top: 4px solid var(--gold);
      animation: fadeInUp 0.5s ease forwards;
      opacity: 0;
    }
    .heat-card:nth-child(1) { animation-delay: 0.03s; }
    .heat-card:nth-child(2) { animation-delay: 0.06s; }
    .heat-card:nth-child(3) { animation-delay: 0.09s; }
    .heat-card:nth-child(4) { animation-delay: 0.12s; }
    .heat-card:nth-child(5) { animation-delay: 0.15s; }
    .heat-card:nth-child(6) { animation-delay: 0.18s; }
    .heat-card:nth-child(7) { animation-delay: 0.21s; }
    .heat-card:nth-child(8) { animation-delay: 0.24s; }
    .heat-card:nth-child(9) { animation-delay: 0.27s; }
    .heat-card:nth-child(10) { animation-delay: 0.30s; }
    .heat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(10,22,40,0.15);
    }

    .heat-card-image {
      width: 100%;
      height: 160px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      position: relative;
      overflow: hidden;
    }
    .heat-card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Rank badge */
    .heat-rank {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 900;
      box-shadow: 0 3px 12px rgba(0,0,0,0.3);
      z-index: 2;
    }
    .heat-rank-1 { background: linear-gradient(135deg, #FFD700, #FFA500); color: #333; font-size: 20px; width: 46px; height: 46px; }
    .heat-rank-2 { background: linear-gradient(135deg, #C0C0C0, #A0A0A0); color: #333; }
    .heat-rank-3 { background: linear-gradient(135deg, #CD7F32, #A0522D); color: #fff; }
    .heat-rank-default { background: var(--primary); color: var(--gold); }

    /* Hotness badge on image */
    .heat-tier-badge {
      position: absolute;
      bottom: 10px;
      left: 10px;
      padding: 5px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
      backdrop-filter: blur(6px);
      color: #fff;
      z-index: 2;
    }

    /* Card content */
    .heat-card-body {
      padding: 16px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .heat-card-body .category-tag {
      display: inline-block;
      background: rgba(10,22,40,0.06);
      color: var(--primary);
      padding: 3px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 4px;
      width: fit-content;
    }
    .heat-card-body h3 {
      font-size: 17px;
      font-weight: 800;
      color: var(--primary);
      margin: 4px 0;
    }
    .heat-card-body .neighborhood-line {
      color: var(--text-muted);
      font-size: 13px;
      margin-bottom: 6px;
    }
    .heat-card-body .neighborhood-line::before { content: "ğŸ“ "; }

    /* Rating row */
    .heat-rating-row {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      color: var(--text-light);
      margin-bottom: 8px;
    }
    .heat-rating-row .stars { color: var(--gold); }

    /* Trending Reasons */
    .heat-reasons {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }
    .heat-reason {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: rgba(201,168,76,0.1);
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      color: var(--primary);
    }

    /* Hotness bar */
    .heat-score-bar {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    .heat-score-track {
      flex: 1;
      height: 6px;
      background: var(--border);
      border-radius: 3px;
      overflow: hidden;
    }
    .heat-score-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.6s ease;
    }
    .heat-score-label {
      font-size: 13px;
      font-weight: 800;
      min-width: 50px;
      text-align: center;
    }

    /* Actions */
    .heat-card-actions {
      display: flex;
      gap: 8px;
      margin-top: auto;
      padding-top: 10px;
    }

    /* Empty state */
    .heatmap-empty {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
      grid-column: 1 / -1;
    }
    .heatmap-empty .emoji { font-size: 64px; margin-bottom: 16px; }
    .heatmap-empty h3 { font-size: 20px; color: var(--text); margin-bottom: 8px; }

    /* Responsive */
    @media (max-width: 768px) {
      .heatmap-map { height: 40vh; min-height: 280px; }
      .heatmap-cards-grid { grid-template-columns: 1fr; }
      .heatmap-top-header h2 { font-size: 20px; }
      .heat-card-image { height: 140px; }
      .heatmap-legend { gap: 10px; font-size: 12px; }
    }
    @media (max-width: 480px) {
      .heatmap-container { padding: 0 12px; }
      .heatmap-update-banner { font-size: 13px; padding: 12px 16px; }
    }
  </style>

  <script defer src="js/main.js"></script>
  <script defer src="js/darkmode.js"></script>
  <script defer src="js/crowd.js"></script>
  <script defer src="js/hotness.js"></script>
  <script defer src="js/lists.js"></script>
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script defer src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script>
    const catIconMap = {
      'cafe': 'â˜•', 'restaurant': 'ğŸ½ï¸', 'activity': 'ğŸ­',
      'shopping': 'ğŸ›ï¸', 'nature': 'ğŸï¸', 'entertainment': 'ğŸ®',
      'desserts': 'ğŸ°', 'events': 'ğŸª'
    };
    const catNameMap = {
      'cafe': 'ÙƒØ§ÙÙŠÙ‡', 'restaurant': 'Ù…Ø·Ø¹Ù…', 'activity': 'ØªØ±ÙÙŠÙ‡',
      'shopping': 'ØªØ³ÙˆÙ‚', 'nature': 'Ø·Ø¨ÙŠØ¹Ø©', 'entertainment': 'Ø£Ù„Ø¹Ø§Ø¨',
      'desserts': 'Ø­Ù„ÙˆÙŠØ§Øª', 'events': 'ÙØ¹Ø§Ù„ÙŠØ§Øª'
    };

    let allPlaces = [];
    let currentCategory = 'all';
    let heatMap = null;
    let heatClusterGroup = null;

    function updateLiveTime() {
      const now = new Date();
      const riyadh = new Date(now.getTime() + (3 * 60 * 60 * 1000));
      const h = riyadh.getUTCHours();
      const m = riyadh.getUTCMinutes();
      const ampm = h >= 12 ? 'Ù…' : 'Øµ';
      const dh = h > 12 ? h - 12 : (h === 0 ? 12 : h);
      const dayNames = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
      const dayName = dayNames[riyadh.getUTCDay()];
      document.getElementById('live-time').textContent =
        `Ù…Ø¨Ø§Ø´Ø± Â· ${dayName} ${dh}:${String(m).padStart(2, '0')} ${ampm} Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø±ÙŠØ§Ø¶`;
      
      const months = ['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];
      document.getElementById('last-update').textContent = 
        `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${riyadh.getUTCDate()} ${months[riyadh.getUTCMonth()]} ${riyadh.getUTCFullYear()} Â· ${dh}:${String(m).padStart(2, '0')} ${ampm}`;
    }

    function renderHeatCard(place, rank) {
      const score = place.hotnessScore;
      const tier = place.hotnessTier;
      const reasons = place.trendingReasons;
      const cat = place.category_en || place.category;
      const maxScore = 100;
      const pct = Math.min(Math.round((score / maxScore) * 100), 100);

      const rankClass = rank <= 3 ? `heat-rank-${rank}` : 'heat-rank-default';

      const reasonsHtml = reasons.map(r => 
        `<span class="heat-reason">${r.icon} ${r.text}</span>`
      ).join('');

      return `
        <article class="heat-card" data-id="${place.id}">
          <div class="heat-card-image">
            ${place.image_url ? `<img src="${place.image_url}" alt="${place.name_ar}" loading="lazy" onerror="this.style.display='none'">` : ''}
            <div class="heat-rank ${rankClass}">${rank}</div>
            <div class="heat-tier-badge" style="background:${tier.color};">${tier.label}</div>
          </div>
          <div class="heat-card-body">
            <span class="category-tag">${catIconMap[cat] || 'ğŸ“'} ${catNameMap[cat] || place.category}</span>
            <h3>${place.name_ar}</h3>
            <div class="neighborhood-line">${place.neighborhood}</div>
            <div class="heat-rating-row">
              <span class="stars">${generateStars(place.google_rating)}</span>
              <span>${place.google_rating} Â· ${formatNumber(place.review_count)} ØªÙ‚ÙŠÙŠÙ…</span>
            </div>
            ${reasons.length > 0 ? `<div class="heat-reasons">${reasonsHtml}</div>` : ''}
            <div class="heat-score-bar">
              <span style="font-size:12px;color:var(--text-muted);">ğŸŒ¡ï¸</span>
              <div class="heat-score-track">
                <div class="heat-score-fill" style="width:${pct}%;background:${tier.color};"></div>
              </div>
              <span class="heat-score-label" style="color:${tier.color};">${Math.round(score)}</span>
            </div>
            <div class="heat-card-actions">
              <a href="place.html?id=${place.id}" class="btn-primary">Ø§Ø¹Ø±Ù Ø£ÙƒØ«Ø±</a>
              <a href="${place.google_maps_url}" target="_blank" class="btn-outline">ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹</a>
              <button class="btn-outline" onclick="showAddToListModal('${place.id}')" title="Ø£Ø¶Ù Ù„Ù‚Ø§Ø¦Ù…Ø©">ğŸ“‹</button>
            </div>
          </div>
        </article>
      `;
    }

    function renderHeatMap(hotPlaces) {
      if (!heatMap) {
        heatMap = L.map('heatmap', { zoomControl: true }).setView([24.7136, 46.6753], 11);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: 'Â© OpenStreetMap',
          maxZoom: 18,
        }).addTo(heatMap);
      }

      // Clear existing markers
      if (heatClusterGroup) {
        heatMap.removeLayer(heatClusterGroup);
      }

      heatClusterGroup = L.markerClusterGroup({
        maxClusterRadius: 40,
        spiderfyOnMaxZoom: true,
        showCoverageOnHover: false,
        chunkedLoading: true,
        iconCreateFunction: function(cluster) {
          const count = cluster.getChildCount();
          const size = count > 10 ? 48 : 40;
          return L.divIcon({
            html: `<div style="
              background:linear-gradient(135deg, #e74c3c, #c0392b);
              color:#fff;border-radius:50%;
              width:${size}px;height:${size}px;
              display:flex;align-items:center;justify-content:center;
              font-size:14px;font-weight:900;font-family:'Tajawal',sans-serif;
              box-shadow:0 3px 12px rgba(231,76,60,0.4);
              border:3px solid rgba(255,255,255,0.9);
            ">${count}</div>`,
            className: 'heat-cluster',
            iconSize: [size, size],
          });
        }
      });

      hotPlaces.forEach((place, index) => {
        if (!place.lat || !place.lng) return;
        const rank = index + 1;
        const marker = L.marker([place.lat, place.lng], {
          icon: createHeatMarkerIcon(place, rank)
        });
        marker.bindPopup(createHeatPopup(place, rank), { maxWidth: 320 });
        heatClusterGroup.addLayer(marker);
      });

      heatMap.addLayer(heatClusterGroup);

      // Fit bounds if markers exist
      if (hotPlaces.length > 0) {
        const bounds = hotPlaces
          .filter(p => p.lat && p.lng)
          .map(p => [p.lat, p.lng]);
        if (bounds.length > 0) {
          heatMap.fitBounds(bounds, { padding: [30, 30], maxZoom: 13 });
        }
      }
    }

    function renderAll() {
      const hotPlaces = getHottestPlaces(allPlaces, 20, currentCategory);
      
      // Update card count
      document.getElementById('top-count').textContent = `Ø¹Ø±Ø¶ ${hotPlaces.length} Ù…ÙƒØ§Ù†`;

      // Render cards
      const cardsContainer = document.getElementById('heatmap-cards');
      if (hotPlaces.length === 0) {
        cardsContainer.innerHTML = `
          <div class="heatmap-empty">
            <div class="emoji">ğŸ”</div>
            <h3>Ù…Ø§ Ù„Ù‚ÙŠÙ†Ø§ Ø£Ù…Ø§ÙƒÙ† Ø±Ø§Ø¦Ø¬Ø© Ø¨Ù‡Ø§Ù„ØªØµÙ†ÙŠÙ</h3>
            <p>Ø¬Ø±Ø¨ ØªØµÙ†ÙŠÙ Ø«Ø§Ù†ÙŠ</p>
          </div>
        `;
      } else {
        cardsContainer.innerHTML = hotPlaces.map((p, i) => renderHeatCard(p, i + 1)).join('');
      }

      // Render map markers
      renderHeatMap(hotPlaces);
    }

    document.addEventListener('DOMContentLoaded', async () => {
      allPlaces = await loadPlaces();
      
      updateLiveTime();
      setInterval(updateLiveTime, 30000);

      renderAll();

      // Category filter tabs
      document.querySelectorAll('#heat-category-filters .filter-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('#heat-category-filters .filter-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          currentCategory = tab.dataset.cat;
          renderAll();
        });
      });

      // Auto-refresh every 5 minutes
      setInterval(renderAll, 5 * 60 * 1000);
    });
  </script>
  <script>
    document.querySelectorAll('.nav-dropdown > a').forEach(a => {
      a.addEventListener('click', (e) => {
        if (window.innerWidth <= 768) {
          e.preventDefault();
          a.parentElement.classList.toggle('open');
        }
      });
    });
    document.querySelectorAll('.dropdown-submenu > a').forEach(a => {
      a.addEventListener('click', (e) => {
        if (window.innerWidth <= 768) {
          e.preventDefault();
          a.nextElementSibling.style.display = a.nextElementSibling.style.display === 'block' ? 'none' : 'block';
        }
      });
    });
  </script>
  <script src="js/analytics.js" defer></script>
  <script src="js/ramadan.js" defer></script>
</body>
</html>
