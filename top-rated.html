<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/svg+xml" href="images/icon-192.svg">
  <title>â­ Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ â€” Ø£Ù…Ø§ÙƒÙ† Ø¨ØªÙ‚ÙŠÙŠÙ… Ù¤.Ù¥+ | ÙˆÙŠÙ† Ù†Ø±ÙˆØ­</title>
  <meta name="description" content="Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ Ø­Ø³Ø¨ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Google. Ù…Ø·Ø§Ø¹Ù…ØŒ ÙƒØ§ÙÙŠÙ‡Ø§ØªØŒ ØªØ±ÙÙŠÙ‡ Ø¨ØªÙ‚ÙŠÙŠÙ… Ù…Ù…ØªØ§Ø². Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª.">
  <meta name="keywords" content="Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø±ÙŠØ§Ø¶, Ø£ÙØ¶Ù„ ØªÙ‚ÙŠÙŠÙ…, Ù…Ø·Ø§Ø¹Ù… Ù…Ù…ØªØ§Ø²Ø©, ÙƒØ§ÙÙŠÙ‡Ø§Øª Ù…Ù…ØªØ§Ø²Ø©">
  <link rel="canonical" href="https://treklaps.github.io/riyadh-places/top-rated.html">
  <meta property="og:title" content="â­ Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ â€” Ø£Ù…Ø§ÙƒÙ† Ø¨ØªÙ‚ÙŠÙŠÙ… Ù¤.Ù¥+">
  <meta property="og:description" content="Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ Ø­Ø³Ø¨ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Google Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©">
  <meta property="og:url" content="https://treklaps.github.io/riyadh-places/top-rated.html">
  <meta property="og:locale" content="ar_SA">
  <meta property="og:image" content="https://treklaps.github.io/riyadh-places/images/icon-512.svg">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0a1628">
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preload" href="data/places-light.json" as="fetch" crossorigin>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Tajawal',sans-serif;background:#0a1628;color:#e0e0e0;direction:rtl;min-height:100vh}
    a{color:#c9a84c;text-decoration:none}
    .header{background:linear-gradient(135deg,#0a1628 0%,#1a2a4a 100%);padding:12px 20px;position:sticky;top:0;z-index:100;border-bottom:1px solid rgba(201,168,76,0.2)}
    .header-inner{display:flex;align-items:center;justify-content:space-between;max-width:1400px;margin:auto}
    .logo{text-decoration:none;color:#c9a84c;display:flex;align-items:center;gap:8px}
    .logo h1{font-size:1.2rem;margin:0}
    .back-link{color:#c9a84c;font-size:14px}
  </style>
  <link rel="stylesheet" href="css/style.css">
  <style>
    .hero{background:linear-gradient(135deg,#0a1628 0%,#1a1a0a 50%,#1a2d50 100%);padding:50px 20px 45px;text-align:center;position:relative}
    .hero::after{content:'';position:absolute;bottom:0;left:0;right:0;height:4px;background:linear-gradient(90deg,transparent,#c9a84c,transparent)}
    .hero h2{font-size:2rem;font-weight:900;margin-bottom:10px;color:#fff}
    .hero h2 span{color:#c9a84c}
    .hero p{color:rgba(255,255,255,0.7);font-size:16px;max-width:600px;margin:0 auto;line-height:1.8}

    .container{max-width:1200px;margin:0 auto;padding:20px}

    /* Rating Distribution Chart */
    .chart-section{background:#1c2333;border-radius:16px;padding:24px;margin-bottom:24px;border:1px solid rgba(201,168,76,0.15)}
    .chart-title{font-size:1.1rem;font-weight:700;color:#c9a84c;margin-bottom:16px}
    .chart-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    .chart-bars{display:flex;flex-direction:column;gap:8px}
    .chart-row{display:flex;align-items:center;gap:10px}
    .chart-label{min-width:50px;font-size:13px;color:#888;text-align:left}
    .chart-bar-bg{flex:1;height:20px;background:#0a1628;border-radius:4px;overflow:hidden}
    .chart-bar-fill{height:100%;border-radius:4px;transition:width 0.6s ease}
    .chart-count{min-width:50px;font-size:13px;color:#888;text-align:right}
    .chart-summary{display:flex;flex-direction:column;justify-content:center;align-items:center;gap:8px}
    .chart-avg{font-size:3rem;font-weight:900;color:#c9a84c}
    .chart-avg-label{color:#888;font-size:14px}
    .chart-total{font-size:14px;color:#888}
    .chart-cat-bars{display:flex;flex-direction:column;gap:8px;margin-top:20px}
    .cat-bar-row{display:flex;align-items:center;gap:8px}
    .cat-bar-label{min-width:60px;font-size:12px;color:#888}
    .cat-bar-bg{flex:1;height:14px;background:#0a1628;border-radius:3px;overflow:hidden}
    .cat-bar-fill{height:100%;border-radius:3px}
    .cat-bar-val{min-width:30px;font-size:12px;color:#c9a84c;text-align:right}

    .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:20px}
    .search-input{flex:1;min-width:200px;padding:12px 16px;border-radius:12px;border:1px solid rgba(201,168,76,0.3);background:#1c2333;color:#e0e0e0;font-family:inherit;font-size:15px}
    .search-input::placeholder{color:#666}
    .search-input:focus{outline:none;border-color:#c9a84c}
    select.filter-select{padding:12px 16px;border-radius:12px;border:1px solid rgba(201,168,76,0.3);background:#1c2333;color:#e0e0e0;font-family:inherit;font-size:14px}

    .rating-filter{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:20px}
    .rating-btn{padding:8px 16px;border-radius:20px;border:1px solid rgba(201,168,76,0.3);background:transparent;color:#c9a84c;font-family:inherit;font-size:13px;cursor:pointer;transition:all 0.2s;font-weight:600}
    .rating-btn:hover,.rating-btn.active{background:#c9a84c;color:#0a1628}

    .result-count{color:#888;font-size:14px;margin-bottom:16px}

    .places-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:16px}
    .place-card{background:#1c2333;border-radius:16px;overflow:hidden;border:1px solid rgba(201,168,76,0.1);transition:all 0.3s;text-decoration:none;color:inherit;display:block}
    .place-card:hover{border-color:rgba(201,168,76,0.3);transform:translateY(-2px)}
    .pcard-top{display:flex;justify-content:space-between;align-items:flex-start;padding:16px 20px}
    .pcard-info{flex:1}
    .pcard-name{font-size:16px;font-weight:700;color:#e0e0e0;margin-bottom:2px}
    .pcard-name-en{font-size:12px;color:#888}
    .pcard-meta{display:flex;gap:10px;flex-wrap:wrap;margin-top:4px;font-size:13px;color:#888}
    .pcard-rating-block{display:flex;flex-direction:column;align-items:center;min-width:60px}
    .pcard-rating-num{font-size:1.5rem;font-weight:900;color:#c9a84c}
    .pcard-stars{color:#f59e0b;font-size:12px}
    .pcard-desc{padding:0 20px 12px;font-size:13px;color:#aaa;line-height:1.6}
    .pcard-footer{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-top:1px solid rgba(255,255,255,0.06);background:rgba(0,0,0,0.1)}
    .pcard-cat{font-size:12px;color:#888}
    .pcard-price{color:#c9a84c;font-size:13px;font-weight:600}

    .load-more{display:block;margin:24px auto;padding:12px 40px;border-radius:12px;border:1px solid rgba(201,168,76,0.3);background:transparent;color:#c9a84c;font-family:inherit;font-size:15px;cursor:pointer;transition:all 0.2s;font-weight:600}
    .load-more:hover{background:rgba(201,168,76,0.1)}

    .loading{text-align:center;padding:60px;color:#888;font-size:18px}
    .footer{background:#0d1117;padding:30px 20px;text-align:center;color:#555;font-size:13px;border-top:1px solid rgba(201,168,76,0.1);margin-top:40px}
    .footer a{color:#c9a84c}

    @media(max-width:768px){
      .hero{padding:30px 16px 25px}
      .hero h2{font-size:1.5rem}
      .container{padding:16px}
      .controls{flex-direction:column}
      .search-input,.filter-select{width:100%}
      .places-grid{grid-template-columns:1fr}
      .chart-grid{grid-template-columns:1fr}
      .chart-avg{font-size:2rem}
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo"><h1>ğŸ™ï¸ ÙˆÙŠÙ† Ù†Ø±ÙˆØ­</h1></a>
      <a href="index.html" class="back-link">â† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>
  </header>

  <section class="hero">
    <h2>â­ <span>Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹</span> ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶</h2>
    <p>Ø£Ù…Ø§ÙƒÙ† Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ø£Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù…Ù† Ø²ÙˆØ§Ø± Ø­Ù‚ÙŠÙ‚ÙŠÙŠÙ† â€” Ù…Ø±ØªØ¨Ø© Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø£Ù‚Ù„</p>
  </section>

  <div class="container">
    <!-- Rating Distribution Chart -->
    <div class="chart-section" id="chartSection"></div>

    <!-- Filters -->
    <div class="rating-filter" id="ratingFilter">
      <button class="rating-btn active" data-min="0">Ø§Ù„ÙƒÙ„</button>
      <button class="rating-btn" data-min="4.5">Ù¤.Ù¥+ â­</button>
      <button class="rating-btn" data-min="4.0">Ù¤.Ù + â­</button>
      <button class="rating-btn" data-min="3.5">Ù£.Ù¥+ â­</button>
    </div>

    <div class="controls">
      <input type="text" class="search-input" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù†...">
      <select class="filter-select" id="categoryFilter">
        <option value="">ÙƒÙ„ Ø§Ù„ÙØ¦Ø§Øª</option>
      </select>
      <select class="filter-select" id="neighborhoodFilter">
        <option value="">ÙƒÙ„ Ø§Ù„Ø£Ø­ÙŠØ§Ø¡</option>
      </select>
    </div>

    <div class="result-count" id="resultCount"></div>
    <div id="loading" class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
    <div class="places-grid" id="grid"></div>
    <button class="load-more" id="loadMore" style="display:none">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ â†“</button>
  </div>

  <footer class="footer">
    <p>ğŸ“Š Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù…Ù† Google Maps â€” Ù…Ø­Ø¯Ø«Ø© Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø±</p>
    <p style="margin-top:8px">ÙˆÙŠÙ† Ù†Ø±ÙˆØ­ Ø¨Ø§Ù„Ø±ÙŠØ§Ø¶ØŸ â€” <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a> | <a href="best.html">Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ù…Ø§ÙƒÙ†</a> | <a href="trending.html">Ø§Ù„Ø£ÙƒØ«Ø± Ø±ÙˆØ§Ø¬Ø§Ù‹</a></p>
  </footer>

<script>
const toAr = n => n.toString().replace(/\d/g, d => 'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'[d]);
const CAT_EMOJIS = {'Ù…Ø·Ø¹Ù…':'ğŸ½ï¸','ÙƒØ§ÙÙŠÙ‡':'â˜•','ØªØ±ÙÙŠÙ‡':'ğŸ®','Ø­Ù„ÙˆÙŠØ§Øª':'ğŸ°','ØªØ³ÙˆÙ‚':'ğŸ›ï¸','Ø·Ø¨ÙŠØ¹Ø©':'ğŸŒ¿','ÙÙ†Ø§Ø¯Ù‚':'ğŸ¨','Ø´Ø§Ù„ÙŠÙ‡':'ğŸ¡','Ù…ÙˆÙ„Ø§Øª':'ğŸ¬','Ù…ØªØ§Ø­Ù':'ğŸ›ï¸','ÙØ¹Ø§Ù„ÙŠØ§Øª':'ğŸ­'};

let allPlaces = [];
let ratedPlaces = [];
let displayCount = 50;
let minRating = 0;

function getStars(r) {
  const f = Math.floor(r);
  const h = r % 1 >= 0.3;
  return 'â˜…'.repeat(f) + (h?'Â½':'') + 'â˜†'.repeat(5-f-(h?1:0));
}

async function loadData() {
  try {
    allPlaces = await fetch('data/places-light.json').then(r => r.json());
    ratedPlaces = allPlaces.filter(p => p.r && p.r > 0).sort((a,b) => b.r - a.r);
    
    document.getElementById('loading').style.display = 'none';

    // Categories
    const cats = [...new Set(ratedPlaces.map(p=>p.c).filter(Boolean))].sort();
    const catFilter = document.getElementById('categoryFilter');
    cats.forEach(c => { const o=document.createElement('option'); o.value=c; o.textContent=`${CAT_EMOJIS[c]||''} ${c}`; catFilter.appendChild(o); });

    // Neighborhoods
    const hoods = [...new Set(ratedPlaces.map(p=>p.h).filter(Boolean))].sort((a,b)=>a.localeCompare(b,'ar'));
    const hoodFilter = document.getElementById('neighborhoodFilter');
    hoods.forEach(h => { const o=document.createElement('option'); o.value=h; o.textContent=h; hoodFilter.appendChild(o); });

    renderChart();
    render();
  } catch(e) {
    document.getElementById('loading').innerHTML = 'âŒ Ø®Ø·Ø£: ' + e.message;
  }
}

function renderChart() {
  // Rating distribution
  const dist = {5:0, 4:0, 3:0, 2:0, 1:0};
  const catAvg = {};
  for (const p of ratedPlaces) {
    const bucket = Math.floor(p.r);
    if (bucket >= 1 && bucket <= 5) dist[bucket]++;
    if (p.c) {
      if (!catAvg[p.c]) catAvg[p.c] = {sum:0,count:0};
      catAvg[p.c].sum += p.r;
      catAvg[p.c].count++;
    }
  }
  const maxDist = Math.max(...Object.values(dist));
  const totalRated = ratedPlaces.length;
  const overallAvg = (ratedPlaces.reduce((s,p)=>s+p.r,0)/totalRated).toFixed(1);

  const barColors = {5:'#22c55e',4:'#84cc16',3:'#f59e0b',2:'#f97316',1:'#ef4444'};
  
  // Top 8 categories by average rating
  const catRanked = Object.entries(catAvg)
    .map(([c,v])=>({c, avg:(v.sum/v.count).toFixed(1), count:v.count}))
    .sort((a,b)=>b.avg-a.avg)
    .slice(0,8);

  document.getElementById('chartSection').innerHTML = `
    <div class="chart-title">ğŸ“Š ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª â€” ${toAr(totalRated)} Ù…ÙƒØ§Ù†</div>
    <div class="chart-grid">
      <div class="chart-bars">
        ${[5,4,3,2,1].map(r => `<div class="chart-row">
          <div class="chart-label">${'â­'.repeat(r)}</div>
          <div class="chart-bar-bg"><div class="chart-bar-fill" style="width:${(dist[r]/maxDist*100)}%;background:${barColors[r]}"></div></div>
          <div class="chart-count">${toAr(dist[r])}</div>
        </div>`).join('')}
      </div>
      <div class="chart-summary">
        <div class="chart-avg">${overallAvg}</div>
        <div class="chart-avg-label">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù…</div>
        <div class="chart-total">${toAr(totalRated)} Ù…ÙƒØ§Ù† Ù…ÙÙ‚ÙŠÙ‘Ù…</div>
        <div class="chart-cat-bars">
          <div style="font-size:13px;color:#888;margin-bottom:4px;font-weight:600">Ù…ØªÙˆØ³Ø· Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©:</div>
          ${catRanked.map(c => `<div class="cat-bar-row">
            <div class="cat-bar-label">${CAT_EMOJIS[c.c]||''} ${c.c}</div>
            <div class="cat-bar-bg"><div class="cat-bar-fill" style="width:${(c.avg/5*100)}%;background:linear-gradient(to left,#c9a84c,#22c55e)"></div></div>
            <div class="cat-bar-val">${c.avg}</div>
          </div>`).join('')}
        </div>
      </div>
    </div>
  `;
}

function render() {
  const query = (document.getElementById('searchInput').value||'').trim().toLowerCase();
  const cat = document.getElementById('categoryFilter').value;
  const hood = document.getElementById('neighborhoodFilter').value;

  let filtered = ratedPlaces.filter(p => {
    if (minRating > 0 && p.r < minRating) return false;
    if (cat && p.c !== cat) return false;
    if (hood && p.h !== hood) return false;
    if (query && !(p.n||'').includes(query) && !(p.ne||'').toLowerCase().includes(query)) return false;
    return true;
  });

  document.getElementById('resultCount').textContent = `Ø¹Ø±Ø¶ ${toAr(Math.min(displayCount, filtered.length))} Ù…Ù† ${toAr(filtered.length)} Ù…ÙƒØ§Ù†`;

  const showing = filtered.slice(0, displayCount);
  document.getElementById('grid').innerHTML = showing.map(p => `<a href="place.html?id=${p.id}" class="place-card">
    <div class="pcard-top">
      <div class="pcard-info">
        <div class="pcard-name">${p.n}</div>
        ${p.ne ? `<div class="pcard-name-en">${p.ne}</div>` : ''}
        <div class="pcard-meta">
          <span>${CAT_EMOJIS[p.c]||''} ${p.c||'Ø£Ø®Ø±Ù‰'}</span>
          <span>ğŸ“ ${p.h||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
        </div>
      </div>
      <div class="pcard-rating-block">
        <div class="pcard-rating-num">${p.r}</div>
        <div class="pcard-stars">${getStars(p.r)}</div>
      </div>
    </div>
    ${p.d ? `<div class="pcard-desc">${p.d.substring(0,120)}${p.d.length>120?'...':''}</div>` : ''}
    <div class="pcard-footer">
      <span class="pcard-cat">${p.au?.length ? p.au.join(' â€¢ ') : ''}</span>
      ${p.p ? `<span class="pcard-price">${p.p}</span>` : ''}
    </div>
  </a>`).join('');

  const loadMoreBtn = document.getElementById('loadMore');
  loadMoreBtn.style.display = filtered.length > displayCount ? '' : 'none';
}

// Events
document.getElementById('searchInput').addEventListener('input', () => { displayCount = 50; render(); });
document.getElementById('categoryFilter').addEventListener('change', () => { displayCount = 50; render(); });
document.getElementById('neighborhoodFilter').addEventListener('change', () => { displayCount = 50; render(); });
document.getElementById('loadMore').addEventListener('click', () => { displayCount += 50; render(); });

document.querySelectorAll('.rating-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.rating-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    minRating = parseFloat(btn.dataset.min);
    displayCount = 50;
    render();
  });
});

loadData();
</script>
</body>
</html>
