<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/svg+xml" href="images/icon-192.svg">
  <title>ğŸ§´ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¹Ø·ÙˆØ± ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ â€” Ø£Ø³Ø¹Ø§Ø±ØŒ Ø¨Ø¯Ø§Ø¦Ù„ØŒ Ù…Ø­Ù„Ø§Øª | ÙˆÙŠÙ† Ù†Ø±ÙˆØ­</title>
  <meta name="description" content="Ù‚Ø§Ø±Ù† Ø£Ø³Ø¹Ø§Ø± Ø£Ø´Ù‡Ø± 100 Ø¹Ø·Ø± ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ Ø¹Ø¨Ø± 10+ Ù…ØªØ§Ø¬Ø±. Ø§ÙƒØªØ´Ù Ø§Ù„Ø¨Ø¯Ø§Ø¦Ù„ ÙˆØ§Ù„ØªÙ‚Ù„ÙŠØ¯ Ø¨Ø£Ø³Ø¹Ø§Ø± Ø£Ù‚Ù„. Ù…Ø­Ù„Ø§Øª Ø§Ù„Ø¹Ø·ÙˆØ± Ù…Ø¹ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†.">
  <meta name="keywords" content="Ø¹Ø·ÙˆØ± Ø§Ù„Ø±ÙŠØ§Ø¶, Ù…Ù‚Ø§Ø±Ù†Ø© Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¹Ø·ÙˆØ±, Ø¨Ø¯Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø·ÙˆØ±, ÙƒØ±ÙŠØ¯ Ø£ÙÙŠÙ†ØªÙˆØ³, Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù„Ù„Ø¹ÙˆØ¯, Ù‚ÙˆÙ„Ø¯Ù† Ø³Ù†Øª, Ø³ÙŠÙÙˆØ±Ø§">
  <link rel="canonical" href="https://treklaps.github.io/riyadh-places/perfume.html">
  <meta property="og:title" content="ğŸ§´ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¹Ø·ÙˆØ± ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ â€” Ø£Ø³Ø¹Ø§Ø±ØŒ Ø¨Ø¯Ø§Ø¦Ù„ØŒ Ù…Ø­Ù„Ø§Øª">
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:description" content="Ù‚Ø§Ø±Ù† Ø£Ø³Ø¹Ø§Ø± 100 Ø¹Ø·Ø± Ø¹Ø¨Ø± 10+ Ù…ØªØ§Ø¬Ø± Ù…Ø¹ Ø§Ù„Ø¨Ø¯Ø§Ø¦Ù„ Ø§Ù„Ø£Ø±Ø®Øµ">
  <meta property="og:url" content="https://treklaps.github.io/riyadh-places/perfume.html">
  <meta property="og:locale" content="ar_SA">
  <meta property="og:image" content="https://treklaps.github.io/riyadh-places/images/icon-512.svg">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0a1628">
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Tajawal',sans-serif;background:#0a1628;color:#e0e0e0;direction:rtl;min-height:100vh}
    a{color:#c9a84c;text-decoration:none}
    .header{background:linear-gradient(135deg,#0a1628 0%,#1a2a4a 100%);padding:12px 20px;position:sticky;top:0;z-index:100;border-bottom:1px solid rgba(201,168,76,0.2)}
    .header-inner{display:flex;align-items:center;justify-content:space-between;max-width:1400px;margin:auto}
    .logo{text-decoration:none;color:#c9a84c;display:flex;align-items:center;gap:8px}
    .logo h1{font-size:1.2rem;margin:0}
    .back-link{color:#c9a84c;font-size:14px}
  </style>
  <link rel="stylesheet" href="css/style.css">
  <style>
    .hero{background:linear-gradient(135deg,#0a1628 0%,#1a0a28 50%,#1a2d50 100%);padding:50px 20px 45px;text-align:center;position:relative}
    .hero::after{content:'';position:absolute;bottom:0;left:0;right:0;height:4px;background:linear-gradient(90deg,transparent,#c9a84c,transparent)}
    .hero h2{font-size:2rem;font-weight:900;margin-bottom:10px;color:#fff}
    .hero h2 span{color:#c9a84c}
    .hero p{color:rgba(255,255,255,0.7);font-size:16px;max-width:600px;margin:0 auto;line-height:1.8}
    .stats-bar{display:flex;gap:16px;justify-content:center;flex-wrap:wrap;margin-top:20px}
    .stat-item{background:rgba(201,168,76,0.1);border:1px solid rgba(201,168,76,0.2);border-radius:12px;padding:10px 18px;text-align:center}
    .stat-item .num{font-size:1.4rem;font-weight:900;color:#c9a84c}
    .stat-item .lbl{font-size:12px;color:rgba(255,255,255,0.6)}

    .container{max-width:1200px;margin:0 auto;padding:20px}
    
    .tabs{display:flex;gap:8px;margin-bottom:24px;flex-wrap:wrap}
    .tab{padding:10px 20px;border-radius:12px;border:1px solid rgba(201,168,76,0.3);background:transparent;color:#c9a84c;font-family:inherit;font-size:14px;cursor:pointer;transition:all 0.2s;font-weight:600}
    .tab:hover,.tab.active{background:#c9a84c;color:#0a1628}

    .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:20px}
    .search-input{flex:1;min-width:200px;padding:12px 16px;border-radius:12px;border:1px solid rgba(201,168,76,0.3);background:#1c2333;color:#e0e0e0;font-family:inherit;font-size:15px}
    .search-input::placeholder{color:#666}
    .search-input:focus{outline:none;border-color:#c9a84c}
    select.filter-select{padding:12px 16px;border-radius:12px;border:1px solid rgba(201,168,76,0.3);background:#1c2333;color:#e0e0e0;font-family:inherit;font-size:14px}

    .result-count{color:#888;font-size:14px;margin-bottom:16px}
    .section-title{font-size:1.3rem;color:#c9a84c;margin:30px 0 16px;font-weight:700}

    /* Perfume Cards */
    .perfume-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:16px}
    .perfume-card{background:#1c2333;border-radius:16px;overflow:hidden;border:1px solid rgba(201,168,76,0.1);transition:all 0.3s}
    .perfume-card:hover{border-color:rgba(201,168,76,0.3);transform:translateY(-2px)}
    .pcard-header{padding:16px 20px;border-bottom:1px solid rgba(201,168,76,0.1)}
    .pcard-name{font-size:17px;font-weight:700;color:#c9a84c}
    .pcard-brand{font-size:13px;color:#888}
    .pcard-meta{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px}
    .pcard-tag{font-size:11px;padding:3px 10px;border-radius:10px;background:rgba(201,168,76,0.1);color:#c9a84c}
    .pcard-body{padding:16px 20px}
    .pcard-notes{margin-bottom:12px}
    .pcard-notes-title{font-size:12px;color:#888;margin-bottom:4px}
    .pcard-notes-list{font-size:13px;color:#aaa;line-height:1.6}
    .pcard-rating{display:flex;align-items:center;gap:6px;font-size:14px;color:#f59e0b;margin-bottom:10px}
    .pcard-prices{display:flex;flex-direction:column;gap:6px}
    .price-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.04);font-size:13px}
    .price-row:last-child{border:none}
    .price-shop{color:#aaa}
    .price-val{font-weight:700}
    .price-val.cheapest{color:#22c55e}
    .price-val.expensive{color:#ef4444}
    .savings-badge{background:rgba(34,197,94,0.1);color:#22c55e;padding:6px 12px;border-radius:10px;font-size:12px;font-weight:700;text-align:center;margin-top:8px}

    /* Alternatives */
    .alt-card{background:#1c2333;border-radius:16px;padding:20px;border:1px solid rgba(201,168,76,0.1)}
    .alt-original{font-size:16px;font-weight:700;color:#c9a84c;margin-bottom:4px}
    .alt-original-price{font-size:13px;color:#888;margin-bottom:12px}
    .dupe-list{display:flex;flex-direction:column;gap:8px}
    .dupe-item{background:#0a1628;border-radius:10px;padding:12px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px}
    .dupe-info .dupe-name{font-weight:600;font-size:14px}
    .dupe-info .dupe-brand{font-size:12px;color:#888}
    .dupe-right{text-align:left}
    .dupe-price{color:#22c55e;font-weight:700;font-size:15px}
    .dupe-similarity{font-size:11px;color:#888}

    /* Shops */
    .shop-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px}
    .shop-card{background:#1c2333;border-radius:16px;padding:20px;border:1px solid rgba(201,168,76,0.1)}
    .shop-name{font-size:17px;font-weight:700;color:#c9a84c;margin-bottom:4px}
    .shop-name-en{font-size:12px;color:#888;margin-bottom:10px}
    .shop-info{font-size:13px;color:#aaa;line-height:1.8}
    .shop-info strong{color:#e0e0e0}
    .shop-branches{font-size:12px;color:#888;margin-top:8px;line-height:1.6}
    .shop-links{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .shop-link{padding:6px 12px;border-radius:8px;background:rgba(201,168,76,0.1);color:#c9a84c;font-size:12px;font-weight:600}

    /* Apps comparison */
    .app-compare-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px}
    .app-card{background:#1c2333;border-radius:16px;padding:20px;border:1px solid rgba(201,168,76,0.1)}
    .app-card h3{color:#c9a84c;font-size:16px;margin-bottom:10px}
    .app-detail{font-size:13px;color:#aaa;line-height:2}
    .app-detail strong{color:#e0e0e0}

    .loading{text-align:center;padding:60px;color:#888;font-size:18px}
    .footer{background:#0d1117;padding:30px 20px;text-align:center;color:#555;font-size:13px;border-top:1px solid rgba(201,168,76,0.1);margin-top:40px}
    .footer a{color:#c9a84c}

    @media(max-width:768px){
      .hero{padding:30px 16px 25px}
      .hero h2{font-size:1.5rem}
      .container{padding:16px}
      .controls{flex-direction:column}
      .search-input,.filter-select{width:100%}
      .perfume-grid,.shop-grid,.app-compare-grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo"><h1>ğŸ™ï¸ ÙˆÙŠÙ† Ù†Ø±ÙˆØ­</h1></a>
      <a href="index.html" class="back-link">â† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>
  </header>

  <section class="hero">
    <h2>ğŸ§´ <span>Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø·ÙˆØ±</span> ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶</h2>
    <p>Ù‚Ø§Ø±Ù† Ø£Ø³Ø¹Ø§Ø± Ù¡Ù Ù  Ø¹Ø·Ø± Ø¹Ø¨Ø± Ù¡Ù + Ù…ØªØ§Ø¬Ø±ØŒ Ø§ÙƒØªØ´Ù Ø§Ù„Ø¨Ø¯Ø§Ø¦Ù„ Ø§Ù„Ø£Ø±Ø®ØµØŒ ÙˆØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù…Ø­Ù„Ø§Øª Ø§Ù„Ø¹Ø·ÙˆØ±</p>
    <div class="stats-bar" id="heroStats"></div>
  </section>

  <div class="container">
    <div class="tabs">
      <button class="tab active" data-tab="perfumes">ğŸ§´ Ø§Ù„Ø¹Ø·ÙˆØ±</button>
      <button class="tab" data-tab="alternatives">ğŸ”„ Ø§Ù„Ø¨Ø¯Ø§Ø¦Ù„</button>
      <button class="tab" data-tab="shops">ğŸª Ø§Ù„Ù…Ø­Ù„Ø§Øª</button>
      <button class="tab" data-tab="apps">ğŸ“± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</button>
    </div>

    <!-- Perfumes Tab -->
    <div id="tab-perfumes">
      <div class="controls">
        <input type="text" class="search-input" id="perfumeSearch" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ø·Ø± Ø£Ùˆ Ù…Ø§Ø±ÙƒØ©... (Ø¹Ø±Ø¨ÙŠ/Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)">
        <select class="filter-select" id="genderFilter">
          <option value="">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
          <option value="Ø±Ø¬Ø§Ù„ÙŠ">Ø±Ø¬Ø§Ù„ÙŠ</option>
          <option value="Ù†Ø³Ø§Ø¦ÙŠ">Ù†Ø³Ø§Ø¦ÙŠ</option>
          <option value="Ù„Ù„Ø¬Ù†Ø³ÙŠÙ†">Ù„Ù„Ø¬Ù†Ø³ÙŠÙ†</option>
        </select>
        <select class="filter-select" id="typeFilter">
          <option value="">ÙƒÙ„ Ø§Ù„ÙØ¦Ø§Øª</option>
        </select>
        <select class="filter-select" id="perfumeSortSelect">
          <option value="name">Ø£Ø¨Ø¬Ø¯ÙŠ</option>
          <option value="cheapest">Ø§Ù„Ø£Ø±Ø®Øµ</option>
          <option value="expensive">Ø§Ù„Ø£ØºÙ„Ù‰</option>
          <option value="rating">Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹</option>
          <option value="savings">Ø§Ù„Ø£ÙƒØ«Ø± ØªÙˆÙÙŠØ±Ø§Ù‹</option>
        </select>
      </div>
      <div class="result-count" id="perfumeCount"></div>
      <div class="perfume-grid" id="perfumeGrid"></div>
    </div>

    <!-- Alternatives Tab -->
    <div id="tab-alternatives" style="display:none">
      <div class="controls">
        <input type="text" class="search-input" id="altSearch" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ø·Ø± Ø£ØµÙ„ÙŠ Ù„Ù„Ø¨Ø¯Ø§Ø¦Ù„...">
      </div>
      <div class="result-count" id="altCount"></div>
      <div class="perfume-grid" id="altGrid"></div>
    </div>

    <!-- Shops Tab -->
    <div id="tab-shops" style="display:none">
      <div class="controls">
        <input type="text" class="search-input" id="shopSearch" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø­Ù„ Ø¹Ø·ÙˆØ±...">
      </div>
      <div class="shop-grid" id="shopGrid"></div>
    </div>

    <!-- Apps Tab -->
    <div id="tab-apps" style="display:none">
      <div class="app-compare-grid" id="appsGrid"></div>
    </div>

    <div id="loading" class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
  </div>

  <footer class="footer">
    <p>âš ï¸ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ØªÙ‚Ø±ÙŠØ¨ÙŠØ© ÙˆÙ‚Ø¯ ØªØ®ØªÙ„Ù Ø­Ø³Ø¨ Ø§Ù„Ø­Ø¬Ù… ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶</p>
    <p style="margin-top:8px">ÙˆÙŠÙ† Ù†Ø±ÙˆØ­ Ø¨Ø§Ù„Ø±ÙŠØ§Ø¶ØŸ â€” <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a> | <a href="prices.html">Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</a> | <a href="delivery-compare.html">Ù‚Ø§Ø±Ù† Ø§Ù„ØªÙˆØµÙŠÙ„</a></p>
  </footer>

<script>
const toAr = n => (n||0).toString().replace(/\d/g, d => 'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'[d]);
let perfumeData = {}, appsData = {};

async function loadData() {
  try {
    const [pd, ad] = await Promise.all([
      fetch('data/perfume-data.json').then(r => r.json()),
      fetch('data/perfume-apps.json').then(r => r.json())
    ]);
    perfumeData = pd;
    appsData = ad;

    // Stats
    document.getElementById('heroStats').innerHTML = `
      <div class="stat-item"><div class="num">${toAr(pd.perfumes?.length||0)}</div><div class="lbl">Ø¹Ø·Ø±</div></div>
      <div class="stat-item"><div class="num">${toAr(pd.shops?.length||0)}</div><div class="lbl">Ù…Ø­Ù„</div></div>
      <div class="stat-item"><div class="num">${toAr(pd.alternatives?.length||0)}</div><div class="lbl">Ø¨Ø¯ÙŠÙ„</div></div>
      <div class="stat-item"><div class="num">${toAr(pd.price_comparisons?.length||0)}</div><div class="lbl">Ù…Ù‚Ø§Ø±Ù†Ø© Ø³Ø¹Ø±</div></div>
    `;

    // Type filter
    const types = [...new Set((pd.perfumes||[]).map(p => p.type || p.category).filter(Boolean))];
    const typeFilter = document.getElementById('typeFilter');
    types.forEach(t => { const o = document.createElement('option'); o.value = t; o.textContent = t; typeFilter.appendChild(o); });

    document.getElementById('loading').style.display = 'none';
    renderPerfumes();
    renderAlternatives();
    renderShops();
    renderApps();
  } catch(e) {
    document.getElementById('loading').innerHTML = 'âŒ Ø®Ø·Ø£: ' + e.message;
  }
}

function renderPerfumes() {
  const query = (document.getElementById('perfumeSearch').value||'').trim().toLowerCase();
  const gender = document.getElementById('genderFilter').value;
  const type = document.getElementById('typeFilter').value;
  const sort = document.getElementById('perfumeSortSelect').value;

  const perfumes = perfumeData.perfumes || [];
  const priceMap = new Map();
  for (const pc of (perfumeData.price_comparisons || [])) {
    priceMap.set(pc.perfume?.toLowerCase(), pc);
  }

  let filtered = perfumes.filter(p => {
    if (gender && p.gender !== gender) return false;
    if (type && p.type !== type && p.category !== type) return false;
    if (query) {
      const match = (p.name||'').toLowerCase().includes(query) || (p.brand||'').toLowerCase().includes(query) || (p.name_ar||'').includes(query);
      if (!match) return false;
    }
    return true;
  });

  // Attach price data
  filtered = filtered.map(p => {
    const key = `${p.name} ${p.size_ml}ml`.toLowerCase();
    const pc = priceMap.get(key) || {};
    const prices = pc.prices || {};
    const validPrices = Object.entries(prices).filter(([,v]) => v != null && v > 0);
    const cheapest = validPrices.length ? Math.min(...validPrices.map(([,v])=>v)) : null;
    const mostExpensive = validPrices.length ? Math.max(...validPrices.map(([,v])=>v)) : null;
    return { ...p, _prices: prices, _cheapest: cheapest, _mostExpensive: mostExpensive, _cheapestShop: pc.cheapest, _validPrices: validPrices };
  });

  if (sort === 'cheapest') filtered.sort((a,b) => (a._cheapest||9999) - (b._cheapest||9999));
  else if (sort === 'expensive') filtered.sort((a,b) => (b._cheapest||0) - (a._cheapest||0));
  else if (sort === 'rating') filtered.sort((a,b) => (b.fragrantica_rating||0) - (a.fragrantica_rating||0));
  else if (sort === 'savings') filtered.sort((a,b) => {
    const sa = a._mostExpensive && a._cheapest ? a._mostExpensive - a._cheapest : 0;
    const sb = b._mostExpensive && b._cheapest ? b._mostExpensive - b._cheapest : 0;
    return sb - sa;
  });

  document.getElementById('perfumeCount').textContent = `Ø¹Ø±Ø¶ ${toAr(filtered.length)} Ø¹Ø·Ø±`;

  document.getElementById('perfumeGrid').innerHTML = filtered.map(p => {
    const notes = p.notes || {};
    const savings = p._mostExpensive && p._cheapest ? Math.round((1 - p._cheapest/p._mostExpensive)*100) : 0;

    return `<div class="perfume-card">
      <div class="pcard-header">
        <div class="pcard-name">${p.name}</div>
        <div class="pcard-brand">${p.brand} â€” ${p.size_ml}ml</div>
        <div class="pcard-meta">
          <span class="pcard-tag">${p.gender || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
          ${p.type ? `<span class="pcard-tag">${p.type}</span>` : ''}
          ${p.longevity ? `<span class="pcard-tag">â±ï¸ ${p.longevity}</span>` : ''}
        </div>
      </div>
      <div class="pcard-body">
        ${p.fragrantica_rating ? `<div class="pcard-rating">â­ ${p.fragrantica_rating} <span style="color:#888;font-size:12px">Fragrantica</span></div>` : ''}
        ${notes.top ? `<div class="pcard-notes">
          <div class="pcard-notes-title">ğŸµ Ø§Ù„Ù†ÙˆØªØ§Øª</div>
          <div class="pcard-notes-list">
            <strong>Ø¹Ù„ÙˆÙŠØ©:</strong> ${notes.top.join('ØŒ ')}<br>
            ${notes.middle ? `<strong>ÙˆØ³Ø·Ù‰:</strong> ${notes.middle.join('ØŒ ')}<br>` : ''}
            ${notes.base ? `<strong>Ù‚Ø§Ø¹Ø¯ÙŠØ©:</strong> ${notes.base.join('ØŒ ')}` : ''}
          </div>
        </div>` : ''}
        ${p._validPrices.length ? `<div class="pcard-prices">
          ${p._validPrices.sort(([,a],[,b])=>a-b).slice(0,6).map(([shop, price]) => 
            `<div class="price-row">
              <span class="price-shop">${shop.replace(/_/g,' ')}</span>
              <span class="price-val ${price === p._cheapest ? 'cheapest' : price === p._mostExpensive ? 'expensive' : ''}">${toAr(price)} Ø±.Ø³</span>
            </div>`
          ).join('')}
        </div>` : '<div style="color:#888;font-size:13px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¹Ø§Ø± Ù…ØªØ§Ø­Ø©</div>'}
        ${savings > 5 ? `<div class="savings-badge">ğŸ’° ÙˆÙÙ‘Ø± ${toAr(savings)}% â€” Ø§Ø´ØªØ±ÙŠÙ‡ Ù…Ù† ${p._cheapestShop || 'Ø§Ù„Ø£Ø±Ø®Øµ'}</div>` : ''}
      </div>
    </div>`;
  }).join('');
}

function renderAlternatives() {
  const query = (document.getElementById('altSearch').value||'').trim().toLowerCase();
  let alts = perfumeData.alternatives || [];
  if (query) alts = alts.filter(a => (a.original||'').toLowerCase().includes(query));

  document.getElementById('altCount').textContent = `${toAr(alts.length)} Ø¹Ø·Ø± Ù…Ø¹ Ø¨Ø¯Ø§Ø¦Ù„`;

  document.getElementById('altGrid').innerHTML = alts.map(a => `<div class="alt-card">
    <div class="alt-original">ğŸ¯ ${a.original}</div>
    <div class="alt-original-price">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ: ${toAr(a.original_price_sar)} Ø±.Ø³</div>
    <div class="dupe-list">
      ${(a.dupes||[]).map(d => `<div class="dupe-item">
        <div class="dupe-info">
          <div class="dupe-name">${d.name}</div>
          <div class="dupe-brand">${d.brand} ${d.source ? 'â€” ' + d.source : ''}</div>
        </div>
        <div class="dupe-right">
          <div class="dupe-price">${toAr(d.price_sar)} Ø±.Ø³</div>
          <div class="dupe-similarity">ØªØ´Ø§Ø¨Ù‡ ${toAr(d.similarity_percent)}%</div>
        </div>
      </div>`).join('')}
    </div>
    <div class="savings-badge">ğŸ’° ÙˆÙÙ‘Ø± Ø­ØªÙ‰ ${toAr(a.original_price_sar - Math.min(...(a.dupes||[]).map(d=>d.price_sar)))} Ø±.Ø³ Ù…Ø¹ Ø§Ù„Ø¨Ø¯ÙŠÙ„</div>
  </div>`).join('');
}

function renderShops() {
  const query = (document.getElementById('shopSearch').value||'').trim().toLowerCase();
  let shops = perfumeData.shops || [];
  if (query) shops = shops.filter(s => (s.name_ar||'').includes(query) || (s.name_en||'').toLowerCase().includes(query));

  document.getElementById('shopGrid').innerHTML = shops.map(s => `<div class="shop-card">
    <div class="shop-name">${s.name_ar || s.name_en}</div>
    ${s.name_en ? `<div class="shop-name-en">${s.name_en}</div>` : ''}
    <div class="shop-info">
      ${s.founded ? `<div>ğŸ“… ØªØ£Ø³Ø³: <strong>${s.founded}</strong></div>` : ''}
      ${s.branches_riyadh ? `<div>ğŸª ÙØ±ÙˆØ¹ Ø§Ù„Ø±ÙŠØ§Ø¶: <strong>${s.branches_riyadh}</strong></div>` : ''}
      ${s.speciality ? `<div>âœ¨ Ø§Ù„ØªØ®ØµØµ: <strong>${s.speciality}</strong></div>` : ''}
      ${s.price_range ? `<div>ğŸ’° Ø§Ù„Ø£Ø³Ø¹Ø§Ø±: <strong>${s.price_range}</strong></div>` : ''}
      ${s.instagram ? `<div>ğŸ“¸ <strong>${s.instagram}</strong></div>` : ''}
      ${s.phone ? `<div>ğŸ“ <strong>${s.phone}</strong></div>` : ''}
    </div>
    ${s.branches_locations ? `<div class="shop-branches">ğŸ“ ${(Array.isArray(s.branches_locations) ? s.branches_locations.slice(0,5).join(' â€¢ ') : s.branches_locations)}${Array.isArray(s.branches_locations) && s.branches_locations.length > 5 ? ` + ${s.branches_locations.length-5} ÙØ±ÙˆØ¹ Ø£Ø®Ø±Ù‰` : ''}</div>` : ''}
    <div class="shop-links">
      ${s.website ? `<a class="shop-link" href="${s.website}" target="_blank">ğŸŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹</a>` : ''}
      ${s.google_maps ? `<a class="shop-link" href="${s.google_maps}" target="_blank">ğŸ“ Ø®Ø±Ø§Ø¦Ø·</a>` : ''}
    </div>
  </div>`).join('');
}

function renderApps() {
  const apps = appsData.apps || [];
  document.getElementById('appsGrid').innerHTML = apps.map(app => `<div class="app-card">
    <h3>${app.name_ar || app.name_en}</h3>
    <div class="app-detail">
      ${app.app_rating ? `<div>â­ ØªÙ‚ÙŠÙŠÙ…: <strong>${app.app_rating}</strong></div>` : ''}
      ${app.downloads ? `<div>ğŸ“¥ ØªØ­Ù…ÙŠÙ„Ø§Øª: <strong>${app.downloads}</strong></div>` : ''}
      ${app.delivery_speed ? `<div>ğŸšš Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙˆØµÙŠÙ„: <strong>${app.delivery_speed}</strong></div>` : ''}
      ${app.delivery_cost ? `<div>ğŸ’° ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙˆØµÙŠÙ„: <strong>${app.delivery_cost}</strong></div>` : ''}
      ${app.coverage ? `<div>ğŸ“ Ø§Ù„ØªØºØ·ÙŠØ©: <strong>${app.coverage}</strong></div>` : ''}
      ${app.return_policy ? `<div>ğŸ”„ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹: <strong>${app.return_policy}</strong></div>` : ''}
      ${app.payment_methods ? `<div>ğŸ’³ Ø§Ù„Ø¯ÙØ¹: <strong>${Array.isArray(app.payment_methods) ? app.payment_methods.join('ØŒ ') : app.payment_methods}</strong></div>` : ''}
    </div>
    <div class="shop-links" style="margin-top:12px">
      ${app.website ? `<a class="shop-link" href="${app.website}" target="_blank">ğŸŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹</a>` : ''}
      ${app.ios_app ? `<a class="shop-link" href="${app.ios_app}" target="_blank">ğŸ iOS</a>` : ''}
      ${app.android_app ? `<a class="shop-link" href="${app.android_app}" target="_blank">ğŸ¤– Android</a>` : ''}
    </div>
  </div>`).join('');
}

// Tab switching
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    const target = tab.dataset.tab;
    ['perfumes','alternatives','shops','apps'].forEach(t => {
      document.getElementById('tab-' + t).style.display = t === target ? '' : 'none';
    });
  });
});

// Search events
document.getElementById('perfumeSearch').addEventListener('input', renderPerfumes);
document.getElementById('genderFilter').addEventListener('change', renderPerfumes);
document.getElementById('typeFilter').addEventListener('change', renderPerfumes);
document.getElementById('perfumeSortSelect').addEventListener('change', renderPerfumes);
document.getElementById('altSearch').addEventListener('input', renderAlternatives);
document.getElementById('shopSearch').addEventListener('input', renderShops);

loadData();
</script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/riyadh-places/sw.js').catch(() => {});
    }
  </script>
</body>
</html>
